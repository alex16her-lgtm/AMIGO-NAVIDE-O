<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ğŸ„ Amigo NavideÃ±o Marvel</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: Arial;
  background: linear-gradient(180deg, #0f172a, #020617);
  color: white;
  padding: 15px;
}
.card {
  background: #1e293b;
  padding: 15px;
  border-radius: 15px;
  margin-bottom: 15px;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 10px;
  cursor: pointer;
}
textarea, input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
}
</style>
</head>

<body>

<h2>ğŸ„ Amigo NavideÃ±o Marvel</h2>

<div class="card">
<h3>ğŸ“± CÃ³mo usar la pÃ¡gina</h3>
<p>1ï¸âƒ£ Ingresa tu cÃ³digo Ãºnico<br>
2ï¸âƒ£ Asigna tu personaje<br>
3ï¸âƒ£ Sortea a quiÃ©n regalas<br>
4ï¸âƒ£ Escribe tus opciones de regalo<br>
5ï¸âƒ£ Guarda</p>
</div>

<div class="card">
<input id="userCode" placeholder="CÃ³digo Ãºnico (ej: MARVEL01)">
<button onclick="loadUser()">Ingresar</button>
</div>

<div class="card">
<h3>ğŸ¦¸â€â™‚ï¸ Tu personaje</h3>
<p id="myCharacter">---</p>
<button onclick="assignCharacter()">Asignar personaje</button>

<h3>ğŸ Regalas a</h3>
<p id="giftCharacter">---</p>
<button onclick="drawGift()">Sortear regalo</button>
</div>

<div class="card">
<textarea id="giftOptions" placeholder="Escribe tu personaje + 3 opciones de regalo"></textarea>
<button onclick="saveOptions()">Guardar</button>
</div>

<div class="card">
<h3>ğŸ€ Opciones de todos</h3>
<ul id="optionsList"></ul>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBKeNX9UmyrXfj-CxrqMj5ZoOtPI-lvysw",
    authDomain: "amigo-navideno-marvel.firebaseapp.com",
    databaseURL: "https://amigo-navideno-marvel-default-rtdb.firebaseio.com",
    projectId: "amigo-navideno-marvel",
    storageBucket: "amigo-navideno-marvel.appspot.com",
    messagingSenderId: "187166636326",
    appId: "1:187166636326:web:1fbbbf1bf2a5468c9929e7"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = null;

const characters = [
'Iron Man','Capitan America','Thor','Hulk','Viuda Negra','Ojo de HalcÃ³n',
'Spider-Man','Doctor Strange','Pantera Negra','Bruja Escarlata','Vision',
'Ant-Man','Wasp','Loki','Capitan Marvel','Deadpool','Thanos'
];

function loadUser() {
  const code = userCode.value.trim();
  if (!code) return alert('Ingresa un cÃ³digo');
  currentUser = code;
  loadData();
}

async function assignCharacter() {
  const ref = db.collection('users').doc(currentUser);
  const doc = await ref.get();
  if (doc.exists && doc.data().character) {
    myCharacter.innerText = doc.data().character;
    return;
  }
  const used = await db.collection('users').get();
  const taken = used.docs.map(d => d.data().character);
  const available = characters.filter(c => !taken.includes(c));
  const chosen = available[Math.floor(Math.random() * available.length)];
  await ref.set({ character: chosen }, { merge: true });
  myCharacter.innerText = chosen;
}

async function drawGift() {
  const all = await db.collection('users').get();
  const others = all.docs.filter(d => d.id !== currentUser);
  const chosen = others[Math.floor(Math.random() * others.length)].data().character;
  giftCharacter.innerText = chosen;
}

async function saveOptions() {
  await db.collection('options').add({
    user: currentUser,
    text: giftOptions.value
  });
  giftOptions.value = '';
  loadData();
}

async function loadData() {
  optionsList.innerHTML = '';
  const snap = await db.collection('options').get();
  snap.forEach(doc => {
    const li = document.createElement('li');
    li.innerText = doc.data().text;
    optionsList.appendChild(li);
  });
}
  if (currentUser === "ADMIN123") {
  await db.collection('users').get().then(s => s.forEach(d => d.ref.delete()));
  await db.collection('options').get().then(s => s.forEach(d => d.ref.delete()));
}

</script>

</body>
</html>





